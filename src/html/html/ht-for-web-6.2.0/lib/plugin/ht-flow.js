!function(h){"use strict";var s="ht",C=h[s],W=C.Default,R=Math,T=R.PI,d=2*T,L=R.sin,I=R.cos,j=R.atan2,X=R.sqrt,k=R.max,U=R.floor,v=(R.round,R.ceil),u=R.abs,r=C.Shape,w=C.Edge,x=C.List,A=C.Style,p=C.graph,E=W.getInternal(),Y=E.ui(),M=null,G="__segmentLengths",Q="__lineTotalLength",z="__linePoints",S="__distance0",o="flow.count",b="flow.step",P="flow.element.max",_="flow.element.count",$="flow.element.min",e="flow.element.space",y="flow.element.autorotate",D="flow.element.background",K="flow.element.shadow.max",i="flow.element.shadow.min",F="flow.element.shadow.begincolor",J="flow.element.shadow.endcolor",V="flow.element.shadow.visible",g="flow.element.image",O="flow",H="prototype",a=p.GraphView[H],f=C.Data[H],m=Y.DataUI[H],l=Y.ShapeUI[H],c=Y.EdgeUI[H],B=C.DataModel[H],n=l._80o,q=c._80o,t=B.prepareRemove,Z=c._79o,N=l._79o,um=a.setDataModel,Sh=function(Q){return document.createElement(Q)};a.calculatePointLength=function(g,Q,U){var $=this,I=$.getDataUI(g);U==M&&(U=.1);var i=fm(I),C=[];if(i){for(var O=i.length,J=0;O>J;J++){var w=i[J];w._as&&(w=w._as);for(var r=w[0],H=1;H<w.length;H++)C.push([r,w[H]]),r=w[H]}for(var t=[],J=0;J<C.length;J++){var Z=co(C[J][0],C[J][1],Q);t.push(Z)}var S=t.slice(0);S.sort(function(S,u){return S.z>u.z?1:S.z<u.z?-1:0});var y=S[0];if(y.z<U){for(var B=t.indexOf(y),s=0,J=0;B>=J;J++)s+=B>J?W.getDistance(C[J][0],C[J][1]):W.getDistance(C[J][0],y);return s}}},W.calculatePointLength=function(T,A,U,m){m==M&&(m=.1);var P=fm(M,T,A),A=[];if(P){for(var c=P.length,F=0;c>F;F++){var $=P[F];$._as&&($=$._as);for(var X=$[0],v=1;v<$.length;v++)A.push([X,$[v]]),X=$[v]}for(var z=[],F=0;F<A.length;F++){var S=co(A[F][0],A[F][1],U);z.push(S)}var k=z.slice(0);k.sort(function(i,j){return i.z>j.z?1:i.z<j.z?-1:0});var Q=k[0];if(Q.z<m){for(var J=z.indexOf(Q),x=0,F=0;J>=F;F++)x+=J>F?W.getDistance(A[F][0],A[F][1]):W.getDistance(A[F][0],Q);return x}}},a.calculateClosestPoint=function(k,V){var _=this,X=_.getDataUI(k),b=fm(X),M=[];if(b){for(var Y=b.length,G=0;Y>G;G++){var Z=b[G];Z._as&&(Z=Z._as);for(var n=Z[0],y=1;y<Z.length;y++)M.push([n,Z[y]]),n=Z[y]}for(var F=[],G=0;G<M.length;G++){var R=co(M[G][0],M[G][1],V);F.push(R)}return F.sort(function(c,q){return c.z>q.z?1:c.z<q.z?-1:0}),F[0]}},W.calculateClosestPoint=function(P,b,W){var K=fm(M,P,b),b=[];if(K){for(var Q=K.length,k=0;Q>k;k++){var Y=K[k];Y._as&&(Y=Y._as);for(var i=Y[0],r=1;r<Y.length;r++)b.push([i,Y[r]]),i=Y[r]}for(var O=[],k=0;k<b.length;k++){var H=co(b[k][0],b[k][1],W);O.push(H)}return O.sort(function(O,H){return O.z>H.z?1:O.z<H.z?-1:0}),O[0]}},a.getPercentAngle=function(o,g){var m=this,Y=m.getDataUI(o),N=o.getRotation?o.getRotation():0,R=fm(Y);if(R)if(0===g){var I=R[0][0],Z=R[0][1];N+=j(Z.y-I.y,Z.x-I.x)}else if(100===g){R=R[R.length-1];var I=R[R.length-2],Z=R[R.length-1];N+=j(Z.y-I.y,Z.x-I.x)}else{for(var G=0,d=[],O=R.length,x=0;O>x;x++){var s=R[x],U=ii(s);G+=U,d.push(U)}for(var h=G*g/100,W=$d(h,d),n=0,A=0;W>A;A++)n+=d[A];h-=n;for(var J=$p(R[W],h),v=R[W],e=0,c=0,r=0;r<v.length-1;r++){var b=v[r],C=v[r+1],w=C.x-b.x,l=C.y-b.y,_=X(w*w+l*l);if(e+=_,e>h){c=r;break}}var f=v[c];N+=j(J.y-f.y,J.x-f.x)}return N},W.getPercentAngle=function(f,K,y){var R=0,g=fm(M,f,K);if(g)if(0===y){var S=g[0][0],w=g[0][1];R+=j(w.y-S.y,w.x-S.x)}else if(100===y){g=g[g.length-1];var S=g[g.length-2],w=g[g.length-1];R+=j(w.y-S.y,w.x-S.x)}else{for(var E=0,L=[],C=g.length,k=0;C>k;k++){var D=g[k],v=ii(D);E+=v,L.push(v)}for(var m=E*y/100,l=$d(m,L),P=0,B=0;l>B;B++)P+=L[B];m-=P;for(var e=$p(g[l],m),d=g[l],x=0,t=0,V=0;V<d.length-1;V++){var J=d[V],G=d[V+1],Y=G.x-J.x,N=G.y-J.y,a=X(Y*Y+N*N);if(x+=a,x>m){t=V;break}}var A=d[t];R+=j(e.y-A.y,e.x-A.x)}return R},a.calculateLength=function(w){var F=this,C=F.getDataUI(w),h=fm(C),P=0;if(h)if(Array.isArray(h[0]))for(var L=h.length,K=0;L>K;K++){var $=h[K],p=ii($);P+=p}else P=ii(h);return P},W.calculateLength=function(z,X){var z=fm(M,z,X),r=0;if(z)if(Array.isArray(z[0]))for(var O=z.length,V=0;O>V;V++){var o=z[V],$=ii(o);r+=$}else r=ii(z);return r};var co=W.calculateClosestPointOnLine=function(_,H,R){var j=_.x,k=_.y,u=H.x,t=H.y,L=R.x,I=R.y,C={},Y=u-j,l=t-k,A=Math.sqrt(Y*Y+l*l),v=Y/A,N=l/A,w=(-j+L)*v+(-k+I)*N;return C.x=j+w*v,C.y=k+w*N,Jh(C,_,H)||(C.x=Math.abs(C.x-_.x)<Math.abs(C.x-H.x)?_.x:H.x,C.y=Math.abs(C.y-_.y)<Math.abs(C.y-H.y)?_.y:H.y),Y=L-C.x,l=I-C.y,C.z=Math.sqrt(Y*Y+l*l),C},Jh=function($,C,R){return $.x>=Math.min(C.x,R.x)&&$.x<=Math.max(C.x,R.x)&&$.y>=Math.min(C.y,R.y)&&$.y<=Math.max(C.y,R.y)},ii=function(y){for(var G=0,h=y.length-1,V=0;h>V;V++){var s=y[V],W=y[V+1],B=W.x-s.x,f=W.y-s.y,_=X(B*B+f*f);G+=_}return G},$p=function(y,Z){for(var w=0,d=0,$=0,D=y.length-1,U=0;D>U;U++){var n=y[U],k=y[U+1],c=k.x-n.x,W=k.y-n.y;if($=X(c*c+W*W),w+=$,w>Z){w-=$,d=U;break}}var r=y[d],V=y[d+1],l=j(V.y-r.y,V.x-r.x),s=Z-w,W=L(l)*s,c=I(l)*s;return{x:r.x+c,y:r.y+W}},pl=function(x,E,$,Q){var e=I(Q),b=L(Q),c=e*E-b*$,Z=b*E+e*$;return x?{x:x.x+c,y:x.y+Z}:{x:c,y:Z}},Up=function(F,j){F[G]=F[Q]=F[z]=j[S]=M},Km=function(_,i,l,Z,G,O){var W,q,r,C,y,o,U,z,S,e,s,Y=[];if(u(Z)>d&&(Z=d),y=v(u(Z)/(T/4)),W=Z/y,q=-W,r=-l,y>0){o=_+I(l)*G,U=i+L(-l)*O,Y.push({x:o,y:U});for(var P=0;y>P;P++)r+=q,C=r-q/2,z=_+I(r)*G,S=i+L(r)*O,e=_+I(C)*(G/I(q/2)),s=i+L(C)*(O/I(q/2)),Y.push({x:e,y:s}),Y.push({x:z,y:S})}return Y},fm=function($,B,f){if(B==M){var U=$._data;if(U instanceof r){if(B=U.getPoints(),f=U.getSegments(),(!f||0===f.size())&&B){f=new C.List([1]);for(var D=1;D<B.size();D++)f.add(2)}}else if(U instanceof w){var c=$._78o;if(c){var b=c.type,N=c.points,a=c.segments,A=c._4O;if(!b||N){var v=c.sourcePoint,u=v.x,_=v.y,K=c.targetPoint,y=K.x,V=K.y;if(b)a?(B=new x({x:u,y:_}),B.addAll(N),B.add({x:y,y:V}),f=new x(a._as)):(B=new x({x:u,y:_}),f=new x([1]),N.each(function(R){B.add(R),f.add(2)}),B.add({x:y,y:V}),f.add(2));else if(c.looped){B=new x(Km(u,_,0,d,c.radius,c.radius)),f=new x([1]);for(var D=0;D<(B.size()-1)/2;D++)f.add(3)}else B=new x,c.center?(B.add({x:c.c1.x,y:c.c1.y}),B.add({x:u,y:_}),B.add({x:y,y:V}),B.add({x:c.c2.x,y:c.c2.y}),f=new x([1,2,2,2])):(B.add({x:u,y:_}),B.add({x:y,y:V}),f=new x([1,2]))}else if(A)if(B=new x(A.points._as),A.segments)f=new x(A.segments._as);else{f=new x([1]);for(var D=1;D<A.points.size();D++)f.add(2)}}}}if(B){if(Array.isArray(B)&&(B=new x(B)),"number"==typeof B.get(0)){for(var g=new C.List,D=0;D<B.size();D+=2)g.add({x:B.get(D),y:B.get(D+1)});B=g}if(!f){f=[];for(var D=0;D<B.size();D++)0===D?f.push(1):f.push(2)}Array.isArray(f)&&(f=new x(f));for(var L=E.toPointsArray(B._as,f._as,50),e=L.length,p=[],D=0;e>D;D++){var H=L[D];H.length>1&&p.push(H)}return p}},dq=function(m){var b=m._data,o=fm(m);if(o){b.s("flow.reverse")&&(o.reverse(),o.forEach(function(u){u.reverse()}));for(var N=0,$=[],J=o.length,C=0;J>C;C++){var g=o[C],t=ii(g);N+=t,$.push(t)}if(b[G]=$,b[Q]=N,b[z]=o,b instanceof w){var r=W.unionPoint(o),_=r.x+r.width/2,x=r.y+r.height/2;b.$10e={x:_,y:x}}tf(m,!0)}},tf=(W.getPercentPositionOnPoints=function(C,b,V){if(C){var s=fm(M,C,b);if(s){var y;if(0===V)y=s[0][0];else if(100===V)s=s[s.length-1],y=s[s.length-1];else{for(var O=0,e=[],z=s.length,X=0;z>X;X++){var Q=s[X],p=ii(Q);O+=p,e.push(p)}for(var T=O*V/100,R=$d(T,e),f=0,d=0;R>d;d++)f+=e[d];T-=f,y=$p(s[R],T)}return y}}},a.getPercentPosition=function(z,X){var y=this,I=y.getDataUI(z),a=fm(I);if(a){var $;if(0===X)$=a[0][0];else if(100===X)a=a[a.length-1],$=a[a.length-1];else{for(var f=0,Z=[],U=a.length,s=0;U>s;s++){var J=a[s],o=ii(J);f+=o,Z.push(o)}for(var n=f*X/100,C=$d(n,Z),V=0,k=0;C>k;k++)V+=Z[k];n-=V,$=$p(a[C],n)}return $}},function(A,R){var z=A._data,c=z[Q],M=z.s(o),x=z.s(b),m=0,l=z[G],g=z.s(P),u=z.s($),L=z.s(_),q=(g-u)/(L-1),I=[];if(l){if(1===L)I.push(g);else if(2===L)I.push(g),I.push(u);else{if(!(L>2))return;I.push(g);for(var f=L-2;f>0;f--)I.push(u+q*f);I.push(u)}var i=0,D=0;I.forEach(function(K){L-1>i&&(D+=z.getFlowElementSpace(K)),i++}),D+=(g+u)/2,m=(c-M*D+D)/M;var k=A[S];for(null==k&&(k=0),R||(k+=x);k>c+D;){var E=A._overCount;E?E++:E=1,E>=M&&(E=null),A._overCount=E,z.s("flow.autoreverse")?E?k-=m+D:(k=0,z.s("flow.reverse",!z.s("flow.reverse"))):k-=m+D}A[S]=k}}),Ek=function(L){var i=L.data,q=this.dm();if(i&&"add"===L.kind){var Y=q.$3e;Y&&i.s(O)&&Y.indexOf(i)<0&&Y.push(i)}"clear"===L.kind&&(q.$3e=[])},$n=function(c){var q=c.property,W=c.data,r=c.newValue,u=this.dm().$3e;if(u&&"s:flow"===q)if(r)u.indexOf(W)<0&&u.push(W);else for(var E=u.length,v=0;E>v;v++)if(u[v]===W){u.splice(v,1);break}},$d=$d=function(i,o){for(var a=0,u=o.length,O=0;u>O;O++){var q=o[O];if(a+=q,a>i)return O}return Math.min(O,u-1)},ur=function(h){var O=this,w=O._data,p=w[Q],u=w[G],E=w[z],e=w.s(o),t=0,c=O[S],I=w.s(P),C=w.s($),W=w.s(_),k=w.s(i),J=w.s(K),v=w.s(y),R=(J-k)/(W-1),q=(I-C)/(W-1),n=w.getRotation?w.getRotation():0,T=w.getPosition?w.p():w.$10e,F=[],Y=[];if(c!=M){if(1===W)F.push(I);else if(2===W)F.push(I),F.push(C);else{if(!(W>2))return;F.push(I);for(var a=W-2;a>0;a--)F.push(C+q*a);F.push(C)}if(1===W)Y.push(J);else if(2===W)Y.push(J),Y.push(k);else{if(!(W>2))return;Y.push(J);for(var a=W-2;a>0;a--)Y.push(k+R*a);Y.push(k)}var s=0,l=0;F.forEach(function(J){W-1>s&&(l+=w.getFlowElementSpace(J)),s++}),l+=(I+C)/2,t=(p-e*l+l)/e,h.save();for(var a=0;e>a;a++){var D=c,m=0,A=O._overCount,r=0;w.s("flow.autoreverse")&&A&&A>e-(a+1)||(D-=a*(t+l),s=0,F.forEach(function(K){var G=D-m;if(G>=0&&p>G){var J=!0,b=$d(G,u);r=0;for(var i=0;b>i;i++)r+=u[i];if(G-=r,J){var f=$p(E[b],G),R=n;if(v){for(var W=E[b],B=0,I=0,$=0;$<W.length-1;$++){var L=W[$],_=W[$+1],o=_.x-L.x,H=_.y-L.y,S=X(o*o+H*H);if(B+=S,B>G){I=$;break}}var P=W[I];R+=j(f.y-P.y,f.x-P.x)}n&&(f=pl(T,f.x-T.x,f.y-T.y,n)),O.$5e(h,f,K,Y[s],R)}}m+=w.getFlowElementSpace(F[s]),s++}))}h.restore()}},vi=function(){var s=this,l=s._data,C=l.s(P),d=!1,c=M;if(s._6I||(d=!0),c=l instanceof w?Z.call(s):N.call(s),l.s(O)&&d){var D=l.s(K),n=l.s(V);n&&D>C&&(C=D),C>0&&W.grow(c,v(C/2)),dq(s)}return!l.s(O)&&d&&Up(l,s),c};f.getFlowElementSpace=function(){return this.s(e)},l._79o=vi,c._79o=vi,A[P]==M&&(A[P]=7),A[$]==M&&(A[$]=0),A[o]==M&&(A[o]=1),A[b]==M&&(A[b]=3),A[_]==M&&(A[_]=10),A[e]==M&&(A[e]=3.5),A[y]==M&&(A[y]=!1),A[D]==M&&(A[D]="rgba(255, 255, 114, 0.4)"),A[F]==M&&(A[F]="rgba(255, 255, 0, 0.3)"),A[J]==M&&(A[J]="rgba(255, 255, 0, 0)"),A[V]==M&&(A[V]=1),A[K]==M&&(A[K]=22),A[i]==M&&(A[i]=4),B.prepareRemove=function(w){t.call(this,w);var H=w._dataModel,B=H.$3e;if(B)for(var L=B.length,E=0;L>E;E++)if(B[E]===w){B.splice(E,1);break}},a.setDataModel=function(J){var l=this,C=l._dataModel;if(C!==J){C&&(C.umm(Ek,l),C.umd($n,l),C.$3e=[]),J.mm(Ek,l),J.md($n,l);var M=J.$3e=[];J.each(function(o){o.s(O)&&M.indexOf(o)<0&&M.push(o)}),um.call(l,J)}},a.setFlowInterval=function(N){var p=this,u=p.$11e;p.$11e=N,p.fp("flowInterval",u,N),p.$7e!=M&&(clearInterval(p.$7e),delete p.$7e,p.enableFlow(N))},a.getFlowInterval=function(){return this.$11e},a.$9e=function(){var C,a,D,w=this,Z=w.tx(),K=w.ty(),H=w.getZoom(),p=w.getWidth(),O=w.getHeight(),o={x:-Z/H,y:-K/H,width:p/H,height:O/H},i=w.dm().$3e,u=w._56I,R=new x;if(i.forEach(function(J){u[J.getId()]&&(C=w.getDataUI(J),C&&(D=C._79o(),D&&R.add(D)))}),0!==R.size()&&(R.each(function(l){W.intersectsRect(o,l)&&(a=W.unionRect(a,l))}),a&&(a&&(W.grow(a,k(1,1/H)),a.x=U(a.x*H)/H,a.y=U(a.y*H)/H,a.width=v(a.width*H)/H,a.height=v(a.height*H)/H,a=W.intersection(o,a)),a))){var P=w._canvas.getContext("2d");P.save(),P.lineCap=W.lineCap,P.lineJoin=W.lineJoin,E.translateAndScale(P,Z,K,H),P.beginPath(),P.rect(a.x,a.y,a.width,a.height),P.clip(),P.clearRect(a.x,a.y,a.width,a.height),w.$6e(P,a),P.restore()}},a.$6e=function(E,Z){var y,A,S=this;S._93db(E),S.each(function(s){S._56I[s._id]&&(y=S.getDataUI(s),y&&(A=y._79o(),(!Z||W.intersectsRect(Z,A))&&y._42(E)))}),S._92db(E)},a.enableFlow=function(y){var f=this,c=f.dm(),u=c.$3e;f.$7e==M&&(u.forEach(function(P){var F=f.getDataUI(P);dq(F)}),f.$7e=setInterval(function(){c.$3e.forEach(function(e){tf(f.getDataUI(e))}),f.$9e()},y||f.$11e||50))},a.disableFlow=function(){var C=this;clearInterval(C.$7e),delete C.$7e;var k=C.dm().$3e;k&&C.$9e()},m.$5e=function(N,z,X,s,a){var U=this,h=U._data,L=U.gv,w=h.s(D),q=h.s(F),e=h.s(J),A=h.s(V),m=L.$8e,r=h.s(g);if(m==M&&(m=L.$8e={}),N.beginPath(),r!=M){var Q=W.getImage(r),B=X/2;N.translate(z.x,z.y),N.rotate(a),N.translate(-z.x,-z.y),W.drawImage(N,Q,z.x-B,z.y-B,X,X,h),N.translate(z.x,z.y),N.rotate(-a),N.translate(-z.x,-z.y)}else N.fillStyle=w,N.arc(z.x,z.y,X/2,0,d,!0),N.fill();if(A){var y=22,$=y+"_"+q+"_"+e,R=m[$];if(R==M){var O=Sh("canvas");E.setCanvas(O,y,y);var I=O.getContext("2d"),K=y/2,p=K,n=K;E.translateAndScale(I,0,0,1),I.beginPath();var G=I.createRadialGradient(p,n,0,p,p,K);G.addColorStop(0,q),G.addColorStop(1,e),I.fillStyle=G,I.arc(p,n,K,0,d,!0),I.fill(),R=m[$]=O}var B=s/2;W.drawImage(N,R,z.x-B,z.y-B,s,s,h)}},c._80o=function(e){q.call(this,e);var B=this,v=B._data,w=B.gv;v.s(O)&&w.$7e!=M&&ur.call(B,e)},l._80o=function(x){n.call(this,x);var l=this,T=l._data,Q=l.gv;T.s(O)&&Q.$7e!=M&&ur.call(l,x)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);