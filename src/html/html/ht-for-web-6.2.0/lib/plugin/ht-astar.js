!function(X,C,i){"use strict";var A=X.ht;A.Astar={},function(p){var L=p();X.AStar=L.astar,X.AStar.Graph=L.Graph}(function(){function I(r){for(var B=r,X=[];B.parent;)X.unshift(B),B=B.parent;return X}function X(){return new d(function(e){return e.f})}function G(V,h){h=h||{},this.nodes=[],this.diagonal=!!h.diagonal,this.grid=[];for(var a=0;a<V.length;a++){this.grid[a]=[];for(var i=0,t=V[a];i<t.length;i++){var r=new P(a,i,t[i]);this.grid[a][i]=r,this.nodes.push(r)}}this.$13x()}function P(r,I,Z){this.x=r,this.y=I,this.weight=Z}function d(E){this.content=[],this.scoreFunction=E}var E={search:function(m,B,W,L){m.$6x(),L=L||{};var b=L.heuristic;b||(b=m.diagonal?E.$4x.diagonal:E.$4x.manhattan);var A=L.closest||!1,Q=L.punish,K=X(),M=B;for(B.h=b(B,W),m.$7x(B),K.push(B);K.size()>0;){var O=K.pop();if(O===W)return I(O);O.closed=!0;for(var u=m.neighbors(O),Y=0,x=u.length;x>Y;++Y){var o=u[Y];if(!o.closed&&!o.$9x()){var v=O.g+o.getCost(O,Q),f=o.visited;(!f||v<o.g)&&(o.visited=!0,o.parent=O,o.h=o.h||b(o,W),o.g=v,o.f=o.g+o.h,m.$7x(o),A&&(o.h<M.h||o.h===M.h&&o.g<M.g)&&(M=o),f?K.$10x(o):K.push(o))}}}return A?I(M):[]},$4x:{manhattan:function(v,j){var X=Math.abs(j.x-v.x),S=Math.abs(j.y-v.y);return X+S},diagonal:function(k,T){var J=1,c=Math.sqrt(2),N=Math.abs(T.x-k.x),y=Math.abs(T.y-k.y);return J*(N+y)+(c-2*J)*Math.min(N,y)}},$5x:function(R){R.f=0,R.g=0,R.h=0,R.visited=!1,R.closed=!1,R.parent=null}};return G.prototype.$13x=function(){this.dirtyNodes=[];for(var g=0;g<this.nodes.length;g++)E.$5x(this.nodes[g])},G.prototype.$6x=function(){for(var I=0;I<this.dirtyNodes.length;I++)E.$5x(this.dirtyNodes[I]);this.dirtyNodes=[]},G.prototype.$7x=function(e){this.dirtyNodes.push(e)},G.prototype.neighbors=function(Z){var r=[],Y=Z.x,O=Z.y,w=this.grid;return w[Y-1]&&w[Y-1][O]&&r.push(w[Y-1][O]),w[Y+1]&&w[Y+1][O]&&r.push(w[Y+1][O]),w[Y]&&w[Y][O-1]&&r.push(w[Y][O-1]),w[Y]&&w[Y][O+1]&&r.push(w[Y][O+1]),this.diagonal&&(w[Y-1]&&w[Y-1][O-1]&&r.push(w[Y-1][O-1]),w[Y+1]&&w[Y+1][O-1]&&r.push(w[Y+1][O-1]),w[Y-1]&&w[Y-1][O+1]&&r.push(w[Y-1][O+1]),w[Y+1]&&w[Y+1][O+1]&&r.push(w[Y+1][O+1])),r},G.prototype.toString=function(){for(var x=[],V=this.grid,F=0;F<V.length;F++){for(var j=[],p=V[F],S=0;S<p.length;S++)j.push(p[S].weight);x.push(j.join(" "))}return x.join("\n")},P.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},P.prototype.getCost=function(E,i){var g;if(g=E&&E.x!=this.x&&E.y!=this.y?1.41421*this.weight:this.weight,i){var v=E;if(!v)return g;var B=v.parent;return B?Math.abs(B.x+this.x-2*v.x)>1e-5?g+i:Math.abs(B.y+this.y-2*v.y)>1e-5?g+i:g:g}},P.prototype.$9x=function(){return 0===this.weight},d.prototype={push:function(n){this.content.push(n),this.$11x(this.content.length-1)},pop:function(){var N=this.content[0],X=this.content.pop();return this.content.length>0&&(this.content[0]=X,this.$12x(0)),N},remove:function(n){var S=this.content.indexOf(n),i=this.content.pop();S!==this.content.length-1&&(this.content[S]=i,this.scoreFunction(i)<this.scoreFunction(n)?this.$11x(S):this.$12x(S))},size:function(){return this.content.length},$10x:function(V){this.$11x(this.content.indexOf(V))},$11x:function(R){for(var $=this.content[R];R>0;){var g=(R+1>>1)-1,n=this.content[g];if(!(this.scoreFunction($)<this.scoreFunction(n)))break;this.content[g]=$,this.content[R]=n,R=g}},$12x:function(r){for(var o=this.content.length,i=this.content[r],P=this.scoreFunction(i);;){var M,X=r+1<<1,I=X-1,A=null;if(o>I){var L=this.content[I];M=this.scoreFunction(L),P>M&&(A=I)}if(o>X){var a=this.content[X],q=this.scoreFunction(a);(null===A?P:M)>q&&(A=X)}if(null===A)break;this.content[r]=this.content[A],this.content[A]=i,r=A}}},{astar:E,Graph:G}});var S=A.Astar.Finder=function(y,r){var W=this;W.gv=y,W.$13x(r),W.refreshMap()};S.prototype={},S.prototype.constructor=S,C.defineProperties(S.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(B){this.gv._astarDebugInfo=B}}}),S.prototype.$13x=function(E){var u=this,h=u.$14x={};E=E||{};var W=E.gridSize||10;h.gridSizeX=E.gridSizeX||W,h.gridSizeY=E.gridSizeY||W,h.rect=E.rect,h.filter=E.filter,h.extendBlocks=E.extendBlocks||3,h.fastOverlap=E.fastOverlap===i?!0:E.fastOverlap,h.nodeRectExtend=E.nodeRectExtend||0,h.diagonal=E.diagonal===i?!0:E.diagonal,h.turnPunish=E.turnPunish===i?.1:E.turnPunish,h.simplify=E.simplify===i?!0:E.simplify,h.toGridCenter=E.toGridCenter===i?!1:E.toGridCenter,h.closest=E.closest===i?!0:E.closest},S.prototype.refreshMap=function(){var _,Y=this,V=Y.$14x,Q=V.gridSizeX,W=V.gridSizeY,X=V.extendBlocks;V.rect?_=V.rect:(_=Y.$15x(),A.Default.grow(_,Q*X,W*X)),A.Default.grow(_,Q,W);var P=Math.floor(_.x/Q)*Q,p=Math.floor(_.y/W)*W,l=Math.ceil(_.width/Q),E=Math.ceil(_.height/W),r=l*Q,g=E*W;Y.$16x={x:P,y:p,w:r,h:g,gridX:Q,gridY:W,xLen:l,yLen:E},Y.$17x(),Y.$21x()},S.prototype.$15x=function(){var a=this.gv;if(a instanceof A.graph.GraphView)return a.getContentRect();var y,t=A.Default.unionRect;return a.dm().each(function(_){a.isVisible(_)&&_.getRect&&(y=t(y,_.getRect()))}),y},S.prototype.$17x=function(){var Q,z,t,$,W=this,K=W.$16x,i=K.xLen,n=K.yLen;for(Q=new Array(i),t=0;i>t;t++)for(Q[t]=z=new Array(n),$=n;$--;)z[$]=1;var A=W.$14x.filter;for(W.gv.dm().each(function(w){A&&A(w)===!1||(!W._debugInfo||w!==W._debugInfo.grid&&w!=W._debugInfo.path)&&W.$1cw(Q,w)}),t=0;i>t;t++)Q[t][0]=1,Q[t][n-1]=1;for($=0;n>$;$++)Q[0][$]=1,Q[i-1][$]=1;W.grid=Q;var T=new AStar.Graph(Q,{diagonal:W.$14x.diagonal});W.graph=T},S.prototype.$18x=function(H,X,w,e,l,y,B,T){var n=this.$19x,R=n(w-H,l-B,e-X,y-T);if(1e-6>=R&&R>=-1e-6)return!1;var J=n(l-H,l-B,y-X,y-T)/R;if(0>J||J>1)return!1;var _=n(w-H,l-H,e-X,y-X)/R;return 0>_||_>1?!1:!0},S.prototype.$19x=function(y,A,T,s){return y*s-A*T},S.prototype.$1aw=function(N,F,f,R){for(var a=[-(F[1]-N[1]),F[0]-N[0]],i=a[0]*(f[0]-N[0])+a[1]*(f[1]-N[1])>=0,O=0,s=R.length;s>O;O+=2)if(a[0]*(R[O]-N[0])+a[1]*(R[O+1]-N[1])>=0===i)return!1;return!0},S.prototype.$1bw=function(K,i){for(var x,o,P=this,b=0,D=K.length;D>b;b+=2)if(x=b===D-2?0:b+2,o=x===D-2?0:x+2,P.$1aw([K[b],K[b+1]],[K[x],K[x+1]],[K[o],K[o+1]],i))return!1;for(var b=0,D=i.length;D>b;b+=2)if(x=b===D-2?0:b+2,o=x===D-2?0:x+2,P.$1aw([i[b],i[b+1]],[i[x],i[x+1]],[i[o],i[o+1]],K))return!1;return!0},S.prototype.$1cw=function(N,S){if(S.getRect){var z=this,c=S.getRect();A.Default.grow(c,z.$14x.nodeRectExtend);var $,x,j,K,E,e,l,C,p,T,M,v=z.$1dw({x:c.x,y:c.y}),V=z.$1dw({x:c.x+c.width,y:c.y+c.height}),w=z.$14x.fastOverlap;if(!w){var y=S.getCorners();l=[],y.forEach(function(J){l.push(J.x,J.y)}),T=z.$14x.gridSizeX/2,M=z.$14x.gridSizeY/2}for(x=Math.max(0,v.x),j=Math.min(V.x,N.length-1),E=Math.max(0,v.y),e=Math.min(V.y,N.length?N[0].length-1:-1),$=x;j>=$;$++)for(K=E;e>=K;K++)if(w)N[$][K]=0;else{p=z.$1ew({x:$,y:K});var L=p.x-T,q=p.x+T,d=p.y-M,P=p.y+M;C=[L,d,L,P,q,P,q,d],z.$1bw(l,C)&&(N[$][K]=0)}}},S.prototype.$1dw=function(j,C){var H=this,$=H.$16x,X=(j.x-$.x)/$.gridX,G=(j.y-$.y)/$.gridY;return C!==!1&&(X=Math.round(X),G=Math.round(G)),{x:X,y:G}},S.prototype.$1ew=function(t){var F=this,r=F.$16x;return{x:t.x*r.gridX+r.x,y:t.y*r.gridY+r.y}},S.prototype.$1fw=function(V){var u=this,g=u.$16x,K=g.xLen,F=g.yLen;if(V.x>=0&&V.x<K&&V.y>=0&&V.y<F)return V;var o={x:V.x,y:V.y};return o.x<0?o.x=0:o.x>=K&&(o.x=K-1),o.y<0?o.y=0:o.y>=F&&(o.y=F-1),o},S.prototype.findPath=function(t,h){var L,B,g,P,a=this,k=a.$1dw(t),f=a.$1dw(h);if(g=a.$1fw(k),P=a.$1fw(f),g!==k&&P!==f){var G=a.$16x,v=G.x-G.gridX/2,W=G.y-G.gridY/2,T=v+G.gridX*G.xLen,S=W+G.gridY*G.yLen;if(!(a.$18x(t.x,t.y,h.x,h.y,v,W,T,W)||a.$18x(t.x,t.y,h.x,h.y,T,W,T,S)||a.$18x(t.x,t.y,h.x,h.y,T,S,v,S)||a.$18x(t.x,t.y,h.x,h.y,v,S,v,W)))return[t,h]}g!==k&&(L=!0,k=g),P!==f&&(B=!0,f=P);var $=a.graph.grid[k.x][k.y],H=a.graph.grid[f.x][f.y],q=AStar.search(a.graph,$,H,{closest:a.$14x.closest,punish:a.$14x.turnPunish});if(!q||!q.length)return null;var o=[];o.push(t),L&&o.push(a.$1ew(q[0]));for(var u=1,Q=q.length;Q-1>u;u++)o.push(a.$1ew(q[u]));if(B)o.push(a.$1ew(q[Q-1])),o.push(h);else{var J=q[Q-1];f.x!==J.x||f.y!==J.y||a.$14x.toGridCenter?o.push(a.$1ew(J)):o.push(h)}return a.$14x.simplify&&(o=a.simplifyPath(o)),a.$20x=o,a.$21x(),o},S.prototype.debugOn=function(M){this.debugFlag=!0,this.debugSettings=M||{},this.$21x()},S.prototype.simplifyPath=function(F){var S=F.length;if(2>=S)return F;var l,d,L=[F[0],F[1]],O=L[0],Q=L[1],T=1e-5;for(l=2;S>l;l++)d=F[l],Math.abs((Q.x-O.x)*(d.y-O.y)-(Q.y-O.y)*(d.x-O.x))<T?Q=L[L.length-1]=d:(O=Q,Q=d,L.push(d));return L},S.prototype.$21x=function(){var D=this;if(D.$22x(),this.debugFlag){var f=D.grid;if(f){var G,C=D.gv;if(D.debugSettings.$16x!==!1){G=[];for(var w,g,M,W,K,$=[],N=D.$14x.gridSizeX/2,y=D.$14x.gridSizeY/2,d=f.length,L=d?f[0].length:0,t=1;d-1>t;t++)for(var Y=1;L-1>Y;Y++)f[t][Y]||(w=D.$1ew({x:t,y:Y}),g=w.x-N,M=w.x+N,W=w.y-y,K=w.y+y,G.push({x:g,y:W},{x:g,y:K},{x:M,y:K},{x:M,y:W}),$.push(1,2,2,2,5));var o=new A.Shape;o.s("shape.border.color","rgba(50, 50, 50, 0.2)"),o.s("shape.border.width",1),o.s("shape.background","rgba(200, 50, 100, 0.2)"),o.s("2d.editable",!1),o.s("2d.selectable",!1),o.setPoints(G),o.setSegments($),D._debugInfo={grid:o},C.dm().add(o)}D.debugSettings.path!==!1&&(G=new A.Shape,D.$20x&&(G.setPoints(D.$20x),G.s("shape.border.color","red"),G.s("shape.border.width",1),G.s("2d.editable",!1),G.s("2d.selectable",!1),G.s("shape.background",null),D._debugInfo||(D._debugInfo={}),D._debugInfo.path=G,C.dm().add(G)))}}},S.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},S.prototype.$22x=function(){var t=this;if(t._debugInfo){var f=t._debugInfo.grid,H=t._debugInfo.path,F=t.gv;f&&F.dm().remove(f),H&&F.dm().remove(H),t._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);