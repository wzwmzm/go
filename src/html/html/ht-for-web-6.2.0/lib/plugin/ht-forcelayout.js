!function(q,W){"use strict";var p="ht",b=p+".layout.",m=q[p]||module.parent.exports.ht,h=m.List,Q=m.DataModel,T=m.Node,F=m.Edge,s=m.Group,D=Math,t=D.sqrt,R=D.random,z=D.max,e=D.min,P=function(c){return c*c};m.Default.getInternal().addMSMap({ms_force:function(M){M._interval=50,M._stepCount=10,M._motionLimit=.01,M._edgeRepulsion=.65,M._nodeRepulsion=.65,M._damper=1,M._maxMotion=0,M._motionRatio=0,M.init=function(X){var E=this;X instanceof Q?E.dm=X:E.gv=X,E._nodeMap={},E._nodes=new h,E._edges=new h},M.start=function(){var g=this,X=g.gv;if(!g._timer){var c=g.cdm=X?X.dm():g.dm;c.mm(g.handleDataModelChange,g),c.md(g.handleDataPropertyChange,g),X&&X.mp(g.handleGV,g),c.each(function(j){if(g.isVisible(j)&&g.isLayoutable(j)&&j instanceof T)if(g instanceof E){var N=j.p3();j.p3([N[0]+R(),N[1]+R(),N[2]+R()])}else N=j.p(),j.p(N.x+R(),N.y+R())}),g._timer=setInterval(function(){g.relax()},g._interval),g._damper=1}},M.stop=function(){var q=this;q._timer&&(q.cdm.umm(q.handleDataModelChange,q),q.cdm.umd(q.handleDataPropertyChange,q),q.gv&&q.gv.ump(q.handleGV,q),clearInterval(q._timer),delete q._timer,delete q.cdm)},M.handleGV=function(Q){var z=this;if("dataModel"===Q.property){var i=Q.oldValue,A=Q.newValue;i&&(i.umm(z.handleDataModelChange,z),i.umd(z.handleDataPropertyChange,z)),this.cdm=A,A.mm(z.handleDataModelChange,z),A.md(z.handleDataPropertyChange,z)}},M.relax=function(){var q=this;if(!(q._damper<.1&&q._maxMotion<q._motionLimit)){this.cdm.each(function(r){q.isVisible(r)&&(r instanceof F?q.addEdge(r):r instanceof T&&q.addNode(r))});for(var h,R,M=0,s=q._edges,Q=q._nodes,n=Q.size();M<q._stepCount;M++){for(s.each(q.relaxEdge,q),h=0;n>h;h++)for(R=0;n>R;R++)q.relaxNode(Q.get(h),Q.get(R));q.moveNode()}q._isAdjusting=1,Q.each(function(f){f.fix||(f.p?f.v.p3(f.p):f.v.p(f.x,f.y))}),delete q._isAdjusting,q._nodeMap={},Q.clear(),s.clear(),q.onRelaxed()}},M.onRelaxed=function(){},M.isRunning=function(){return!!this._timer},M.isVisible=function(Q){return Q.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(Q):!0},M.isLayoutable=function(Q){if(Q.s("layoutable")===!1)return!1;if(Q instanceof s)return!1;var h=this;return h.gv?h.gv.isMovable(Q)&&!h.gv.isSelected(Q):!(h.cdm||h.dm).sm().co(Q)},M.getNodeRepulsion=function(){return this._nodeRepulsion},M.setNodeRepulsion=function(Z){this._nodeRepulsion=Z,this._damper=1},M.getEdgeRepulsion=function(){return this._edgeRepulsion},M.setEdgeRepulsion=function(H){this._edgeRepulsion=H,this._damper=1},M.getStepCount=function(){return this._stepCount},M.setStepCount=function(U){this._stepCount=U,this._damper=1},M.getInterval=function(){return this._interval},M.setInterval=function(E){var M=this;M._interval!==E&&(M._interval=E,M._timer&&(clearInterval(M._timer),M._timer=setInterval(function(){M.relax()},E)))},M.handleDataPropertyChange=function(A){!this._isAdjusting&&this.isVisible(A.data)&&(this._damper=1)},M.handleDataModelChange=function(){this._damper=1},M.damp=function(){var I=this._maxMotion,G=this._damper;this._motionRatio<=.001&&((.2>I||I>1&&.9>G)&&G>.01?this._damper-=.01:.4>I&&G>.003?this._damper-=.003:G>1e-4&&(this._damper-=1e-4)),I<this._motionLimit&&(this._damper=0)}}}),m.layout.ForceLayout=function(D){this.init(D)},m.Default.def(b+"ForceLayout",W,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(J){this._limitBounds=J,this._damper=1},getNodeSize:function(f){var F=this.gv;return F&&F.getDataUIBounds?F.getDataUIBounds(f):f.getRect()},addNode:function(l){var k=this,z=k._nodeMap[l._id];if(z)return z;var x=l.p();z={v:l,x:x.x,y:x.y,dx:0,dy:0,fix:!k.isLayoutable(l),s:k.getNodeSize(l)};var q=z.s,V=t(P(q.width)+P(q.height))*k._nodeRepulsion;return z.r=1>V?100:V,k._nodeMap[l._id]=z,k._nodes.add(z),z},addEdge:function(n){if(n._40I&&n._41I){var U=this,l=U.addNode(n._40I),k=U.addNode(n._41I),M={s:l,t:k};k=k.s,l=l.s;var N=k.width+l.width,q=k.height+l.height;M.length=t(N*N+q*q)*U._edgeRepulsion,M.length<=0&&(M.length=100),U._edges.add(M)}},relaxEdge:function(Q){var y=Q.t,T=Q.s,J=y.x-T.x,_=y.y-T.y,S=t(J*J+_*_),A=100*Q.length,R=.25*J/A*S,P=.25*_/A*S;y.dx=y.dx-R,y.dy=y.dy-P,T.dx=T.dx+R,T.dy=T.dy+P},relaxNode:function(s,l){if(s!==l){var D=0,Z=0,j=s.x-l.x,K=s.y-l.y,N=j*j+K*K;0===N?(D=R(),Z=R()):36e4>N&&(D=j/N,Z=K/N);var H=s.r*l.r/400;D*=H,Z*=H,s.dx+=D,s.dy+=Z,l.dx-=D,l.dy-=Z}},moveNode:function(){var m=this,l=m._limitBounds,s=m._maxMotion,o=0,p=m._damper;m._nodes.each(function(O){if(!O.fix){var g=O.dx*p,s=O.dy*p;if(O.dx=g/2,O.dy=s/2,o=z(t(g*g+s*s),o),O.x+=z(-40,e(40,g)),O.y+=z(-40,e(40,s)),l){O.x<l.x&&(O.x=l.x,m.adjust(1,0)),O.y<l.y&&(O.y=l.y,m.adjust(0,1));var n=O.s;O.x+n.width>l.x+l.width&&(O.x=l.x+l.width-n.width,m.adjust(-1,0)),O.y+n.height>l.y+l.height&&(O.y=l.y+l.height-n.height,m.adjust(0,-1))}}}),m._maxMotion=o,m._motionRatio=o>0?s/o-1:0,m.damp()},adjust:function(T,v){var P=this._limitBounds;this._nodes.each(function(C){T>0?(!P||C.x+C.s.width+T<P.x+P.width)&&(C.x+=T):(!P||C.x+T>P.x)&&(C.x+=T),v>0?(!P||C.y+C.s.height+v<P.y+P.height)&&(C.y+=v):(!P||C.y+v>P.y)&&(C.y+=v)})}});var E=m.layout.Force3dLayout=function(w){this.init(w)};m.Default.def(b+"Force3dLayout",W,{ms_force:1,getNodeSize3d:function(l){return l.s3()},addNode:function(Y){var X=this,$=X._nodeMap[Y._id];if($)return $;$={v:Y,p:Y.p3(),d:[0,0,0],fix:!X.isLayoutable(Y),s:X.getNodeSize3d(Y)};var F=$.s,u=m.Default.getDistance(F)*X._nodeRepulsion;return $.r=1>u?100:u,X._nodeMap[Y._id]=$,X._nodes.add($),$},addEdge:function(B){if(B._40I&&B._41I){var l=this,k=l.addNode(B._40I),v=l.addNode(B._41I),H={s:k,t:v};v=v.s,k=k.s,H.length=t(P(v[0]+k[0])+P(v[1]+k[1])+P(v[2]+k[2]))*l._edgeRepulsion,H.length<=0&&(H.length=100),l._edges.add(H)}},relaxEdge:function(Z){var n=Z.t.p,A=Z.s.p,B=Z.t.d,P=Z.s.d,E=n[0]-A[0],G=n[1]-A[1],f=n[2]-A[2],b=t(E*E+G*G+f*f),W=100*Z.length,M=.25*E/W*b,Y=.25*G/W*b,x=.25*f/W*b;B[0]-=M,B[1]-=Y,B[2]-=x,P[0]+=M,P[1]+=Y,P[2]+=x},relaxNode:function(d,p){if(d!==p){var k=d.p,Q=p.p,f=0,X=0,u=0,U=k[0]-Q[0],y=k[1]-Q[1],Y=k[2]-Q[2],E=U*U+y*y+Y*Y;0===E?(f=R(),X=R(),u=R()):216e6>E&&(f=U/E,X=y/E,u=Y/E);var n=d.r*p.r/400,M=d.d,O=p.d;f*=n,X*=n,u*=n,M[0]+=f,M[1]+=X,M[2]+=u,O[0]-=f,O[1]-=X,O[2]-=u}},moveNode:function(){var M=this,X=M._maxMotion,A=0,o=M._damper;M._nodes.each(function(S){if(!S.fix){var v=S.p,Y=S.d,_=Y[0]*o,T=Y[1]*o,F=Y[2]*o;Y[0]=_/2,Y[1]=T/2,Y[2]=F/2,A=z(t(_*_+T*T+F*F),A),v[0]+=z(-40,e(40,_)),v[1]+=z(-40,e(40,T)),v[2]+=z(-40,e(40,F))}}),M._maxMotion=A,M._motionRatio=A>0?X/A-1:0,M.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);